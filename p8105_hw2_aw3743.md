P8105 Homework 2
================
Aisha Waggeh
October 1 2025

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(readxl)
```

## Problem 1

This problem uses 3 FiveThrityEight datasets:

- `pols-month.csv` – counts of national politicians (governors,
  senators, representatives) by party, and whether the sitting president
  is Republican or Democrat.  
- `snp.csv` – monthly closing values of the S&P stock market index.  
- `unemployment.csv` – monthly unemployment rates from the US Bureau of
  Labor Statistics.

Our goal is to clean and merge these datasets using **year** and
**month** as keys.

*Read the pols data*

``` r
pols_df = read_csv("./data/pols-month.csv")
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
pols_df = janitor::clean_names(pols_df)
```

*Clean the pols data + formart*

``` r
# Clean the pols data
pols_clean = pols_df |>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    month = month.name[month],
    day = as.integer(day),
    president = ifelse(prez_gop == 1, "gop", "dem")
  ) |>
select( -prez_dem, -prez_gop, -day) |>
 arrange(year, month)  

pols_clean
```

    ## # A tibble: 822 × 9
    ##     year month    gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president
    ##    <int> <chr>      <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>    
    ##  1  1947 April         23      51     253      23      45     198 dem      
    ##  2  1947 August        23      51     253      23      45     198 dem      
    ##  3  1947 December      24      51     253      23      45     198 dem      
    ##  4  1947 February      23      51     253      23      45     198 dem      
    ##  5  1947 January       23      51     253      23      45     198 dem      
    ##  6  1947 July          23      51     253      23      45     198 dem      
    ##  7  1947 June          23      51     253      23      45     198 dem      
    ##  8  1947 March         23      51     253      23      45     198 dem      
    ##  9  1947 May           23      51     253      23      45     198 dem      
    ## 10  1947 November      24      51     253      23      45     198 dem      
    ## # ℹ 812 more rows

*Read the snp data*

``` r
snp_df = read_csv("./data/snp.csv")
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
snp_df = janitor::clean_names(snp_df)
```

*Clean the snp data + formart*

``` r
snp_clean = snp_df |>
  separate(date, into = c("month", "day", "year"), sep = "/") |>
  mutate(
    year = as.integer(year),
    # Convert 2-digit year to 4-digit year:
    # Years 50-99 -> 1950-1999, Years 00-49 -> 2000- onwards
    year = ifelse(year >= 50, 1900 + year, 2000 + year),
    month = as.integer(month),
    month = month.name[month],
    day = as.integer(day)
  ) |>
  select(-day) |> # Removing day column since we are merging by month only
  arrange(year, month) |>
  select(year, month, close)

snp_clean
```

    ## # A tibble: 787 × 3
    ##     year month    close
    ##    <dbl> <chr>    <dbl>
    ##  1  1950 April     18.0
    ##  2  1950 August    18.4
    ##  3  1950 December  20.4
    ##  4  1950 February  17.2
    ##  5  1950 January   17.0
    ##  6  1950 July      17.8
    ##  7  1950 June      17.7
    ##  8  1950 March     17.3
    ##  9  1950 May       18.8
    ## 10  1950 November  19.5
    ## # ℹ 777 more rows

*Read the unemployment data*

``` r
unemployment_df = read_csv("./data/unemployment.csv")
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
unemployment_df = janitor::clean_names(unemployment_df)
```

*Tidy the unemployment data + formart*

``` r
unemployment_clean = unemployment_df |>
  pivot_longer(
    cols = jan:dec,
    names_to = "month", 
    values_to = "unemployment_rate"
  ) |>
  mutate(
    month = str_to_title(month),  # Convert to Title Case
    month = month.name[match(month, month.abb)],  # Match with full month names
    year = as.integer(year)
  ) |>
  select(year, month, unemployment_rate) |>
  arrange(year, month)

unemployment_clean
```

    ## # A tibble: 816 × 3
    ##     year month    unemployment_rate
    ##    <int> <chr>                <dbl>
    ##  1  1948 April                  3.9
    ##  2  1948 August                 3.9
    ##  3  1948 December               4  
    ##  4  1948 February               3.8
    ##  5  1948 January                3.4
    ##  6  1948 July                   3.6
    ##  7  1948 June                   3.6
    ##  8  1948 March                  4  
    ##  9  1948 May                    3.5
    ## 10  1948 November               3.8
    ## # ℹ 806 more rows

*Merge all (pols + snp + unemployment) datasets*

``` r
#Need to make sure that we use consistent data type for my merge
pols_clean_fixed = pols_clean |>
  mutate(month = as.character(month))

snp_clean_fixed = snp_clean |>
  mutate(month = as.character(month))

unemployment_clean_fixed = unemployment_clean |>
  mutate(month = as.character(month))
```

``` r
# Now ready for merge, will merge snp into pols first
merged_data = 
  left_join(pols_clean, snp_clean, by = c("year", "month"))

 # Then merge unemployment into the result
final_data =
  left_join(merged_data, unemployment_clean, by = c("year", "month"))

final_data
```

    ## # A tibble: 822 × 11
    ##     year month   gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president close
    ##    <dbl> <chr>     <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>     <dbl>
    ##  1  1947 April        23      51     253      23      45     198 dem          NA
    ##  2  1947 August       23      51     253      23      45     198 dem          NA
    ##  3  1947 Decemb…      24      51     253      23      45     198 dem          NA
    ##  4  1947 Februa…      23      51     253      23      45     198 dem          NA
    ##  5  1947 January      23      51     253      23      45     198 dem          NA
    ##  6  1947 July         23      51     253      23      45     198 dem          NA
    ##  7  1947 June         23      51     253      23      45     198 dem          NA
    ##  8  1947 March        23      51     253      23      45     198 dem          NA
    ##  9  1947 May          23      51     253      23      45     198 dem          NA
    ## 10  1947 Novemb…      24      51     253      23      45     198 dem          NA
    ## # ℹ 812 more rows
    ## # ℹ 1 more variable: unemployment_rate <dbl>

``` r
# Need to check the actual start years for each dataset
print("Pols data start:")
```

    ## [1] "Pols data start:"

``` r
pols_clean |> summarize(min_year = min(year), max_year = max(year))
```

    ## # A tibble: 1 × 2
    ##   min_year max_year
    ##      <int>    <int>
    ## 1     1947     2015

``` r
print("SNP data start:")
```

    ## [1] "SNP data start:"

``` r
snp_clean |> summarize(min_year = min(year), max_year = max(year))
```

    ## # A tibble: 1 × 2
    ##   min_year max_year
    ##      <dbl>    <dbl>
    ## 1     1950     2015

``` r
print("Unemployment data start:")
```

    ## [1] "Unemployment data start:"

``` r
unemployment_clean |> summarize(min_year = min(year), max_year = max(year))
```

    ## # A tibble: 1 × 2
    ##   min_year max_year
    ##      <int>    <int>
    ## 1     1948     2015

``` r
# Checking when SNP data actually begins
snp_clean |> arrange(year) |> head(10)
```

    ## # A tibble: 10 × 3
    ##     year month    close
    ##    <dbl> <chr>    <dbl>
    ##  1  1950 April     18.0
    ##  2  1950 August    18.4
    ##  3  1950 December  20.4
    ##  4  1950 February  17.2
    ##  5  1950 January   17.0
    ##  6  1950 July      17.8
    ##  7  1950 June      17.7
    ##  8  1950 March     17.3
    ##  9  1950 May       18.8
    ## 10  1950 November  19.5

- The pols_clean dataset contains 822 monthly observations of US
  political party control from 1947 to 2015. It tracks the number of
  Republican and Democratic politicians across governors, senators, and
  representatives, along with the sitting president’s party. Each row
  represents the political power distribution for a specific month,
  revealing the political landscape over nearly seven decades.

- The snp dataset contains 787 monthly observations of S&P 500 stock
  market closing values from 1950 to 2015. It tracks the closing price
  of the S&P 500 index for each month, showing the performance of the US
  stock market over six decades. The data reveals long-term trends.

- The unemployment dataset contains 816 monthly observations of US
  unemployment rates from 1948 to 2015. It tracks the monthly
  unemployment percentage, providing a measure of economic health and
  labor market conditions over nearly seven decades. The data shows
  fluctuations in employment levels across different economic cycles and
  historical periods.

- Finally, the merged dataset combines political, financial, and
  economic indicators by joining the three datasets using year and month
  as keys. NA values appear for the unemployment rate in 1947 and for
  S&P closing values from 1947-1949 because these datasets start later
  than the political data (unemployment in 1948, S&P in 1950). The
  resulting dataset contains 822 monthly observations from 1947 to 2015,
  enabling analysis of how political changes correlate with economic
  trends across decades. This comprehensive resource allows us to
  examine relationships between government leadership, stock market
  performance, and labor market conditions over time.

## Problem 2

This problem uses the Mr. Trash Wheel dataset, to read & clean.

``` r
mr_trash_df = read_excel("./data/202409 Trash Wheel Collection Data.xlsx", 
                        sheet = "Mr. Trash Wheel",
                        range = "A2:N655",
                        col_types = "text")

mr_trash_df = janitor::clean_names(mr_trash_df)
```

*Clean the Mr. Trash Wheel data*

``` r
mr_trash_clean = mr_trash_df |>
  filter(!is.na(dumpster) & !is.na(weight_tons)) |>
  mutate(
    across(c(dumpster, year, weight_tons, volume_cubic_yards), as.numeric),
    across(c(plastic_bottles, polystyrene, cigarette_butts, glass_bottles, 
             plastic_bags, wrappers, sports_balls), 
           ~ as.numeric(gsub(",", "", .))),
    homes_powered = as.numeric(homes_powered),
    sports_balls = as.integer(round(sports_balls)),
    trash_wheel = "Mr. Trash Wheel"
  ) |>
  arrange(year, month, dumpster)

mr_trash_clean
```

    ## # A tibble: 651 × 15
    ##    dumpster month     year date   weight_tons volume_cubic_yards plastic_bottles
    ##       <dbl> <chr>    <dbl> <chr>        <dbl>              <dbl>           <dbl>
    ##  1       25 August    2014 41855…        4.39                 16            2140
    ##  2       26 August    2014 41855…        5.33                 17            1630
    ##  3       27 August    2014 41864…        3.58                 20            3640
    ##  4       28 August    2014 41864…        3.1                  17            1430
    ##  5       29 August    2014 41870…        1.77                 10             570
    ##  6       42 December  2014 41974…        1.81                 17            1370
    ##  7       43 December  2014 41990…        3.48                 15             550
    ##  8       44 December  2014 42003…        3.18                 15             640
    ##  9       18 July      2014 41823…        2.54                 15            1640
    ## 10       19 July      2014 41827…        2.41                 15            1730
    ## # ℹ 641 more rows
    ## # ℹ 8 more variables: polystyrene <dbl>, cigarette_butts <dbl>,
    ## #   glass_bottles <dbl>, plastic_bags <dbl>, wrappers <dbl>,
    ## #   sports_balls <int>, homes_powered <dbl>, trash_wheel <chr>
